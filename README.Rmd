---
title: "Bayesian COM-Poisson regression"
author: Charalampos Chanialidis
date: May 4, 2017
output:
  md_document:
    variant: markdown_github
---


combayes
========

combayes implements Bayesian inference for COM-Poisson regression models using exact samplers. It also provides functions for sampling exactly from the COM-poisson distribution (using rejection sampling) and for evaluating exact bounds for the normalisation constant of the probability mass function of the COM-Poisson distribution. More information behind the techniques used can be found in the papers:

* [Retrospective sampling in MCMC with an application to COM-Poisson regression](http://www.maths.gla.ac.uk/~cchanialidis/Slides_and_Papers/cmpstat.pdf)
* [Efficient Bayesian inference for COM-Poisson regression models](https://link.springer.com/article/10.1007/s11222-017-9750-x)



Sampling from COM-Poisson distributions with different dispersion levels
---------------------
```{r eval=FALSE}
n <- 100
# Sampling from an underdispersed COM-Poisson distribution
comp_under <- rcmpois(mu=10,nu=2,n=n)
# Sampling from a COM-Poisson distribution where nu=1 (i.e. Poisson distribution)
comp_poisson <- rcmpois(mu=10,nu=1,n=n)
# Sampling from an overdispersed COM-Poisson distribution
comp_over <- rcmpois(mu=10,nu=0.5,n=n)
#Check mean and variance for each one
distributions <- matrix(0,nrow = n,ncol=3)
distributions[,1]<- comp_under
distributions[,2]<- comp_poisson 
distributions[,3]<- comp_over
apply(distributions,2,mean)
apply(distributions,2,var)
```

Estimate the logarithm of the normalisation constant 
----------------
```{r eval=FALSE}
logzcmpois(mu=10,nu=2)
logzcmpois(mu=10,nu=1)
logzcmpois(mu=10,nu=0.5)
```

Estimating the probability mass function 
-----------------------
```{r eval=FALSE}
#Compare densities of COM-Poisson distribution with different nu
 x <- 0:25
dcmpois(x, mu=10, nu=1)
dcmpois(x, mu=10, nu=0.5)
dcmpois(x, mu=10, nu=2)
matplot(x, cbind(dcmpois(x, mu=10, nu=1),
                 dcmpois(x, mu=10, nu=0.5),
                  dcmpois(x, mu=10, nu=2)), type="o", col=2:4, pch=16, ylab="p.m.f.") legend("topright", col=2:4, lty=1:3, c(expression(nu*"="*1),
                                        expression(nu*"="*0.5),
                                        expression(nu*"="*2)))
```



Bayesian COM-Poisson regression on fertility data
-----------------

```{r eval=FALSE}
# Load data from library Countr
library(Countr)
data(fertility)
# Standardise all non-binary covariates
fertility[,c(2,9,10)] <- scale(fertility[,c(2,9,10)],center=TRUE,scale=TRUE)
result <- cmpoisreg(y=fertility$Y, X=fertility[,-11], num_samples=1e4, burnin=1e3)
colMeans(result$posterior_beta)
colMeans(result$posterior_delta)
# Load packages for MCMC diagnostics
library(coda)
library(mcmcplots)
mcmc_beta  <- mcmc(result$posterior_beta)
mcmc_delta <- mcmc(result$posterior_delta)
colnames(mcmc_beta) <-  c("intercept","German","schooling","vocational education","University","Catholic","Protestant","Muslim","rural","age","age at marriage")
colnames(mcmc_delta) <- colnames(mcmc_beta)
#Plot traceplots of regression coefficients
plot(mcmc_beta)
plot(mcmc_delta)
#Plot caterplots of regression coefficients
caterplot(mcmc_beta,style="plain",bty="n",collapse=FALSE)
abline(v=0,lty=2)
title("Regression coefficients for"~ mu)
caterplot(mcmc_delta,style="plain",bty="n",collapse=FALSE)
abline(v=0,lty=2)
title("Regression coefficients for"~ nu)
```

Bayesian COM-Poisson regression on PhD publications data 
----------------

```{r eval=FALSE}
# Load data from library Rchoice
library(Rchoice)
data(Articles)
# Focusing only on the students with at least one publication
phdpublish <- subset(Articles, art>0)
phdpublish <- transform(phdpublish, art=art-1)
# Standardise all non-binary covariates
phdpublish <- cbind(phdpublish[,c(1,2,3)],scale(phdpublish[,-c(1,2,3)],center=TRUE,scale=TRUE))
result <- cmpoisreg(y=phdpublish$art, X=phdpublish[,2:6], num_samples=1e4, burnin=1e3,prior_var_beta=diag(6),prior_var_delta=diag(6))
colMeans(result$posterior_beta)
colMeans(result$posterior_delta)
mcmc_beta  <- mcmc(result$posterior_beta)
mcmc_delta <- mcmc(result$posterior_delta)
colnames(mcmc_beta) <- c("intercept","female","married","kids","phd","mentor")
colnames(mcmc_delta) <- colnames(mcmc_beta)
#Plot traceplots of regression coefficients
plot(mcmc_beta)
plot(mcmc_delta)
#Plot caterplots of regression coefficients
caterplot(mcmc_beta,style="plain",bty="n",collapse=FALSE)
abline(v=0,lty=2)
title("Regression coefficients for"~ mu)
caterplot(mcmc_delta,style="plain",bty="n",collapse=FALSE)
abline(v=0,lty=2)
title("Regression coefficients for"~ nu)
```
